<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Página de Luis</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    margin:0;
    font-family:'Segoe UI',sans-serif;
    background:linear-gradient(180deg,#0f2027,#203a43,#2c5364);
    overflow-x:hidden;
    color:#333;
}
.estrellas{
    position:fixed;
    width:100%;
    height:100%;
    pointer-events:none;
}
.estrella{
    position:absolute;
    width:2px;
    height:2px;
    background:white;
    opacity:.8;
    animation:caer linear infinite;
}
@keyframes caer{
    from{transform:translateY(-10px)}
    to{transform:translateY(110vh)}
}
h1{
    text-align:center;
    color:white;
    margin:20px;
}
.dashboard{
    max-width:1000px;
    margin:auto;
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    gap:15px;
}
.card{
    background:white;
    padding:20px;
    border-radius:15px;
    text-align:center;
    box-shadow:0 10px 25px rgba(0,0,0,.3);
}
.card h3{margin:0;font-size:14px;color:#555}
.card p{font-size:22px;font-weight:bold;margin-top:10px}
.contenedor{
    max-width:1000px;
    margin:30px auto;
    background:white;
    padding:30px;
    border-radius:20px;
}
label{font-weight:bold}
input,select{
    width:100%;
    padding:12px;
    margin:10px 0 20px;
    border-radius:8px;
    border:1px solid #ccc;
}
.botones{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:15px;
}
button{
    padding:14px;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-size:15px;
}
.agregar{background:#27ae60;color:white}
.excel{background:#16a085;color:white}
table{
    width:100%;
    border-collapse:collapse;
    margin-top:25px;
}
th,td{
    padding:12px;
    border-bottom:1px solid #ddd;
    text-align:center;
}
th{
    background:#2c3e50;
    color:white;
}
.acciones button{
    padding:6px 10px;
    margin:0 3px;
    border-radius:5px;
}
.editar{background:#f39c12;color:white}
.borrar{background:#e74c3c;color:white}
</style>
</head>

<body>

<div class="estrellas" id="estrellas"></div>

<h1>Página de Luis</h1>

<div class="dashboard">
    <div class="card">
        <h3>Total Base</h3>
        <p id="totalBase">$ 0</p>
    </div>
    <div class="card">
        <h3>Total IVA</h3>
        <p id="totalIVA">$ 0</p>
    </div>
    <div class="card">
        <h3>Total General</h3>
        <p id="totalGeneral">$ 0</p>
    </div>
</div>

<div class="contenedor">

<label>Tipo</label>
<select id="tipo">
    <option value="material">Material (19%)</option>
    <option value="mano">Mano de obra (0%)</option>
    <option value="servicio">Servicio (19%)</option>
</select>

<label>Monto base ($ COP)</label>
<input type="number" id="monto">

<div class="botones">
    <button class="agregar" onclick="agregar()">Agregar</button>
    <button class="excel" onclick="exportarExcel()">Exportar Excel</button>
</div>

<table>
<thead>
<tr>
    <th>Tipo</th>
    <th>Base</th>
    <th>IVA</th>
    <th>Total</th>
    <th>Acciones</th>
</tr>
</thead>
<tbody id="tabla"></tbody>
</table>

</div>

<script>
let datos = JSON.parse(localStorage.getItem("cuentasLuis")) || [];

function f(n){ return n.toLocaleString('es-CO'); }

function guardar(){
    localStorage.setItem("cuentasLuis", JSON.stringify(datos));
    recalcular();
}

function recalcular(){
    let b=0,i=0,t=0;
    datos.forEach(d=>{
        b+=d.base;
        i+=d.iva;
        t+=d.total;
    });
    totalBase.innerText="$ "+f(b);
    totalIVA.innerText="$ "+f(i);
    totalGeneral.innerText="$ "+f(t);
    render();
}

function render(){
    tabla.innerHTML="";
    datos.forEach((d,idx)=>{
        tabla.innerHTML+=`
        <tr>
            <td>${d.tipo}</td>
            <td>$ ${f(d.base)}</td>
            <td>$ ${f(d.iva)}</td>
            <td>$ ${f(d.total)}</td>
            <td class="acciones">
                <button class="editar" onclick="editar(${idx})">✏️</button>
                <button class="borrar" onclick="borrar(${idx})">❌</button>
            </td>
        </tr>`;
    });
}

function agregar(){
    let tipo = document.getElementById("tipo").value;
    let base = parseFloat(document.getElementById("monto").value);
    if(!base || base<=0) return alert("Monto inválido");

    let ivaP = (tipo==="mano") ? 0 : 19;
    let iva = base * ivaP / 100;
    let total = base + iva;

    datos.push({tipo,base,iva,total});
    guardar();
    document.getElementById("monto").value="";
}

function borrar(i){
    datos.splice(i,1);
    guardar();
}

function editar(i){
    let nuevo = prompt("Nuevo monto:", datos[i].base);
    if(!nuevo) return;
    nuevo = parseFloat(nuevo);
    let ivaP = (datos[i].tipo==="mano") ? 0 : 19;
    datos[i].base = nuevo;
    datos[i].iva = nuevo * ivaP / 100;
    datos[i].total = datos[i].base + datos[i].iva;
    guardar();
}

function exportarExcel(){
    let html=document.querySelector("table").outerHTML;
    let blob=new Blob([html],{type:'application/vnd.ms-excel'});
    let a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download="Pagina_de_Luis.xls";
    a.click();
}

for(let i=0;i<70;i++){
    let s=document.createElement("div");
    s.className="estrella";
    s.style.left=Math.random()*100+"vw";
    s.style.animationDuration=(3+Math.random()*5)+"s";
    estrellas.appendChild(s);
}

recalcular();
</script>

</body>
</html>
